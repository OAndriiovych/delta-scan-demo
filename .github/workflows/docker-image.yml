name: Docker Image CI

on:
  push:
    branches: [ "test" ]


jobs:

  pre-build:
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: scan code for vulnerabilities
        run: |
          echo Downloading cdefense CLI
          curl https://raw.githubusercontent.com/kaushik94/cdefense-delta/blob/main/cdefense-delta-scan > /tmp/cd-latest-linux-x64.tar.gz && tar -C /usr/local/bin -xzf /tmp/cd-latest-linux-x64.tar.gz && chmod +x /usr/local/bin/cdefense
          echo running scan on $(pwd)
          export SCAN_URL=https://dev.clouddefenseai.com
          cdefense online --api-key=32762768-54f7-4a53-af05-5bc7835bf9a2 --repo-url=https://github.com/OAndriiovych/delta-scan-demo --repo-type=GITHUB --branch=master --pr-id=1